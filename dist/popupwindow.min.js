function PopupWindow(e){var t={title:"",width:400,height:250,resizable:true,content:"",position:{x:400,y:200},style:{},attrs:{},"class":"",theme:"light",titleHeight:38,minWidth:300,minHeight:100,initialZIndex:100};e=$.extend(t,e);var n=this;this.onMouseMove=function(e){n.jel.css("left",this.cx+e.clientX-this.offsetX);n.jel.css("top",this.cy+e.clientY-this.offsetY)};this.close=function(){n.jel.remove()};this.onResize=function(t){if(t.clientX-n.cx>=e.minWidth){n.jel.css("width",t.clientX-n.cx);n.contentDiv.css("width",t.clientX-n.cx)}if(t.clientY-n.cy>=e.minHeight){n.jel.css("height",t.clientY-n.cy);n.contentDiv.css("height",t.clientY-n.cy-e.titleHeight)}};this.jel=$("<div></div>");this.el=this.jel[0];var r=this.jel;this.titleDiv=$("<div></div>");this.closeBtn=$("<button></button>");this.contentDiv=$("<div></div>");var i=this.titleDiv;var s=this.contentDiv;r.addClass("PopupWindow");r.addClass(e.theme);r.css("width",e.width);r.css("height",e.height);r.css("top",e.position.y);r.css("left",e.position.x);$.each(e.style,function(e,t){r.css(e,t)});$.each(e.attrs,function(e,t){r.attr(e,t)});r.addClass(e.class);i.addClass("PopupWindow-title");i.addClass(e.theme);i.html(e.title);i.css("height",e.titleHeight);this.closeBtn.css("float","right");this.closeBtn.html("Close");this.closeBtn.click(n.close);s.addClass("PopupWindow-Content");s.addClass(e.theme);s.css("width",e.width);s.css("height",e.height-e.titleHeight+"px");s.html(e.content);i.append(this.closeBtn);if(e.title.length>0)r.append(i);r.append(s);i.mousedown(function(e){if(PopupWindow.mousedown||e.button==2)return;n.jel.css("z-index",PopupWindow.zi++);n.offsetX=e.clientX;n.offsetY=e.clientY;n.cx=parseInt(n.jel.css("left"));n.cy=parseInt(n.jel.css("top"));PopupWindow.current=n;PopupWindow.mousedown=true});s.click(function(){n.jel.css("z-index",PopupWindow.zi++)});i.mouseup(function(){PopupWindow.current=null;PopupWindow.mousedown=false});if(!PopupWindow.binded){PopupWindow.binded=true;$(document).mousemove(function(){if(PopupWindow.mousedown||PopupWindow.current!=null||PopupWindow.resize!=null||PopupWindow.doresize){if(PopupWindow.mousedown){PopupWindow.current.onMouseMove.apply(PopupWindow.current,arguments)}else if(PopupWindow.doresize){PopupWindow.resize.onResize.apply(PopupWindow.current,arguments)}return false}else{return true}});$(document).mouseup(function(){PopupWindow.current=null;PopupWindow.mousedown=false;PopupWindow.doresize=false});PopupWindow.zi=e.initialZIndex}if(e.resizable){this.resizeLb=$("<div></div>");this.resizeLb.css("position","absolute");this.resizeLb.css("bottom","0");this.resizeLb.css("right","0");this.resizeLb.css("width","10px");this.resizeLb.css("height","10px");this.resizeLb.css("cursor","se-resize");this.contentDiv.append(this.resizeLb);r.css("resize","both");this.resizeLb.mousedown(function(e){if(PopupWindow.doresize||e.button==2)return;PopupWindow.resize=n;PopupWindow.doresize=true;n.cx=parseInt(n.jel.css("left"));n.cy=parseInt(n.jel.css("top"))})}$("body").append(this.el);console.log(this)}